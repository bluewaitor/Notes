# 第2章 什么是Shell

## 2.1 内核和实用工具

UNIX系统在逻辑上被划分为两个不同的部分：内核和实用工具(Utility)。

- 内核 内核是UNIX系统的核心所在，在计算机启动后，存在于内存中，直到关机。  
- 工具 工具位于磁盘中，需要的时候加载到内存中并执行。

Shell也是一个实用工具程序。

## 2.2 登录Shell

- 终端（terminal）
  终端=tty(Teletypewriter, 电传打印机)
- Shell
  命令行解释器
- console
  在计算机发展早期，计算机外表会有一个面板用来对计算机底层进行管理，也可以通过指示灯来得知计算机的运行状态，这个面板就叫做console，可以理解为控制面板。一台电脑有且仅有一个console，但是可以有多个terminal。因为多用户系统，可以理解为console是管理员用的，terminal是其他用户用的。
- bash
  unix系统上可以包含多种不同的Shell，使用`cat /etc/shells`查看。bash是其中一种Shell

现在的电脑，一般启动terminal就会自动登录。通过ssh连接远程服务器，则需要用户名密码，这种叫做`登录Shell`。相反的，有`非登录Shell`，即默认Shell为`/bin/nologin`的用户，这种用户没办法与计算机进行交互，一般用来文件所有权管理。

## 2.3 在Shell中输入命令

1. Shell启动
2. 光标闪烁等待输入
3. 输入命令并按Enter健
4. Shell解析并执行所请求的操作
  如果请求Shell调用某个程序，Shell会搜索磁盘，查找环境变量PATH中指定的所有目录，直到找到指定程序。找到后，Shell会将自己复制一份（称为子Shell），让内核用指定的程序替换掉这个子Shell，接着登录Shell会“休眠”。
5. 等待被调用的程序执行完毕。
6. 输入输出。如果程序将输出写入到标准输出中，则会在终端显示，除非你将其重定向或通过管道导向其他命令。如果程序从标准输入中读取输入，那么它会等着你输入内容，除非输入被重定向到另一个文件或通过管道从其他命令导入。
7. 命令执行完毕后，控制权再次交给登录Shell。
8. 提示你输入下一条命令。重复（2-8）
9. 退出

## 2.4 Shell的职责

- 程序执行
  基本格式`program-name arguments`，更正式些，这一行叫做`命令行`。Shell会扫描命令行，确定要执行的程序名称以及所传入的程序参数。Shell使用空白字符来确定程序名称和参数，包括空格符、水平制表符和行尾符（换行符）。会先判断命令是不是内建命令。
- 变量及文件名替换
  在命令行中将某个变量放在美元符号$之后，Shell会将变量替换为相对应的变量值。除此之外，Shell还要执行文件名替换。替换字符`*`、`?`或`[...]`。(`[abc]`，匹配abc任何一个字符)
- I/O重定向
  扫描命令行，从中查找特殊的重定向字符`<`、`>`或`>>`
- 管道
  扫描命令行，查找管道字符`|`，每找到一个，就会将之前命令的标准输出连接到之后命令的标准输入，然后执行这两个命令。
- 环境控制
  Shell提供了一些能够定制个人环境的命令。个人环境包括主目录、命令行提示符以及用于搜索待执行程序的目录列表。
- 解释型语言
  Shell有自己内建的编程语言。这种语言是解释型的。Shell会分析所遇到的每一条语句，然后执行所发现的有效的命令。
